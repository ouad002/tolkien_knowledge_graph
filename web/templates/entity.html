{% extends "base.html" %}

{% block title %}{{ entity_label }} - Tolkien KG{% endblock %}

{% block content %}
<article class="entity-page">
    <header>
        <h1>{{ entity_label }}</h1>
        {% if entity_type %}
        <span class="badge">{{ entity_type }}</span>
        {% endif %}
    </header>

    <section class="entity-metadata">
        <p><strong>URI:</strong> <code>{{ entity_uri }}</code> 
            <a href="{{ entity_uri }}" title="View as RDF/Turtle" style="margin-left: 10px;">
                <small>[RDF]</small>
            </a>
        </p>
        {% if entity_source %}
        <p><strong>Source:</strong> 
            <a href="{{ entity_source }}" target="_blank" rel="noopener">
                {{ entity_source }}
            </a>
        </p>
        {% endif %}
    </section>

    {% if properties %}
    <section class="entity-properties">
        <h2>Properties</h2>
        <dl>
            {% for prop_name, values in properties.items() %}
            <dt>{{ prop_name }}</dt>
            {% for val in values %}
            <dd>
                {% if val.is_uri %}
                    {% if val.is_internal %}
                        <!-- Internal KG URI - will redirect to Tolkien Gateway if not found -->
                        <a href="{{ url_for('entity', entity_name=val.local_name) }}" 
                           title="{{ val.value }}">
                            {{ val.label }}
                        </a>
                    {% else %}
                        <!-- External URI (source, image, etc.) -->
                        <a href="{{ val.value }}" target="_blank" rel="noopener"
                           title="{{ val.value }}">
                            {% if val.value.startswith('http') and (val.value.endswith('.jpg') or val.value.endswith('.png')) %}
                                üñºÔ∏è {{ val.label|truncate(60) }}
                            {% else %}
                                {{ val.label|truncate(80) }}
                            {% endif %}
                        </a>
                    {% endif %}
                {% else %}
                    <!-- Literal value -->
                    {{ val.label }}
                {% endif %}
            </dd>
            {% endfor %}
            {% endfor %}
        </dl>
    </section>
    {% else %}
    <section class="no-properties">
        <p>No properties found for this entity.</p>
    </section>
    {% endif %}

    <footer class="entity-footer">
        <a href="{{ url_for('index') }}" class="button">‚Üê Back to homepage</a>
        <a href="https://tolkiengateway.net/wiki/{{ entity_label }}" 
           target="_blank" 
           rel="noopener"
           class="button button-secondary">
            View on Tolkien Gateway ‚Üí
        </a>
    </footer>
</article>

<style>
.entity-page {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
}

.entity-page header {
    border-bottom: 3px solid #2c3e50;
    padding-bottom: 15px;
    margin-bottom: 25px;
}

.entity-page h1 {
    margin: 0 0 10px 0;
    color: #2c3e50;
    display: inline-block;
}

.badge {
    background: #3498db;
    color: white;
    padding: 5px 12px;
    border-radius: 4px;
    font-size: 0.85em;
    margin-left: 15px;
    font-weight: normal;
}

.entity-metadata {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 25px;
    font-size: 0.95em;
}

.entity-metadata code {
    background: #e9ecef;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
}

.entity-properties h2 {
    color: #2c3e50;
    margin-bottom: 20px;
    font-size: 1.4em;
}

.entity-properties dl {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 5px;
    padding: 0;
}

.entity-properties dt {
    background: #f1f3f5;
    padding: 12px 20px;
    font-weight: bold;
    color: #495057;
    border-bottom: 1px solid #dee2e6;
    margin: 0;
}

.entity-properties dd {
    padding: 12px 20px;
    margin: 0;
    border-bottom: 1px solid #f1f3f5;
}

.entity-properties dd:last-of-type {
    border-bottom: none;
}

.entity-properties a {
    color: #007bff;
    text-decoration: none;
}

.entity-properties a:hover {
    text-decoration: underline;
}

.no-properties {
    background: #fff3cd;
    padding: 20px;
    border-radius: 5px;
    border-left: 4px solid #ffc107;
}

.entity-footer {
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    gap: 15px;
}

.button {
    display: inline-block;
    padding: 10px 20px;
    background: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    transition: background 0.3s;
}

.button:hover {
    background: #0056b3;
    text-decoration: none;
}

.button-secondary {
    background: #6c757d;
}

.button-secondary:hover {
    background: #545b62;
}
</style>
{% endblock %}
